env:
  KERNEL_FLAVOUR: 6.18

modules:
  - name: Set repos
    type: repos
    body:
      branch: sisyphus
      date: ${{ Env.YEAR }}${{ Env.MONTH }}${{ Env.DAY }}
      clean: true

  - name: Initial includes
    type: include
    body:
      targets:
        - apt-rpm.yml
        - filesystem.yml

  - type: packages
    body:
      update: true
      upgrade: true

  - name: Set branding
    type: branding
    body:
      name: alt-atomic-${{ Env.IMAGE_NAME }}
      build-type: ${{ Env.IMAGE_TYPE }}

  - type: include
    body:
      targets:
        - disable-bins.yml
        - packages.yml
        - network.yml
        - systemd.yml
        - settings.yml
        - passwd.yml
        - fix-dracut.yml

  - name: Copy root
    type: copy
    body:
      source: root
      destination: /
      replace: true

  - name: Configurate grub
    type: shell
    body:
      command: scripts/grub.sh

  - name: Update kernel
    type: kernel
    body:
      kernel-info:
        flavour: ${{ Env.KERNEL_FLAVOUR }}
        modules:
          - drm
      initrd:
        method: dracut

  - name: Cleanup
    type: include
    body:
      targets:
        - /usr/share/apm/includes/common/cleanup.yml
